#!/usr/bin/env node
import {Command}from'commander';import {select,input}from'@inquirer/prompts';import k from'cli-spinners';import {execa}from'execa';import {readFile}from'fs/promises';import $ from'ora';import F from'path';import a from'zod';import B from'os';var v=new Command("hello").description("Say hello to the user!").option("-n, --name <name>","Name to greet","World").action(n=>N(n));async function N(n){console.log(`Hello, ${n.name}`);}var b={version:"0.1.16"};var L=a.object({name:a.string(),options:a.array(a.string()),args:a.array(a.string()),action:a.string()}),R=a.object({version:a.string(),commands:a.array(L)}),w=a.object({name:a.string(),body:a.array(R)});var C=F.join(B.homedir(),"Documents","talos","commands");var A=new Command("e").description("Execute a command").argument("<name>","Name of the command").argument("[extras...]","Additional arguments and options").allowUnknownOption().passThroughOptions().action((n,r,i)=>q(n,i,r));async function q(n,r,i){let h=await select({message:"Where does Talos need to look for the command?",choices:[{name:"Local",value:"local"},{name:"Internet",value:"internet"}]});await U(n,h,{...r,extras:i});}async function U(n,r,i){r==="local"?await K(n,i):r==="internet"&&console.log(`Looking for ${n} on the internet...`);}async function K(n,r={}){let i=$({text:"Looking for command locally...",spinner:{frames:k.circleHalves.frames,interval:80}}).start();await new Promise(e=>setTimeout(e,1e3));let h=F.join(C,`${n}.json`),E=await readFile(h,"utf-8"),P=JSON.parse(E),m=w.parse(P);if(!m){i.fail("Command not found locally.");return}if(i.succeed("Command found locally."),m.body.length<=0){i.fail("No versions found for this command.");return}let l=m.body[0];m.body.length>1&&(l=await select({message:"Select a command version to execute:",choices:m.body.map(c=>({name:c.version,value:c}))})||l);let p=[],T=Array.isArray(r.extras)?r.extras:[],W=new Set(l.commands.flatMap(e=>e.options)),f=H(T,W),z=new Set(f.flags.map(e=>e.flag));for(let e of f.flags)p.push(e.flag),e.value!==null&&p.push(e.value);p.push(...f.unknownTokens),p.push(...f.positionals);for(let e of l.commands){let c=[],g=e.args.filter(o=>x(o)),d=e.args.filter(o=>!x(o));for(let o of g){let t=o.replace(/[\[\]<>]/g,"").trim()||"value",s=await input({message:`What argument are you gonna send? (${t})`});c.push(s);}c.unshift(...d);let u=[...p];if(e.options.length>0&&!e.options.some(t=>z.has(t))){let t=e.options[0],s=await input({message:`What do you want to use for "${t}" argument?`,default:""});s!==""&&u.push(t,s);}for(let o of l.commands){let t=$({text:`Executing command: ${o.name}...`,spinner:{frames:k.circleHalves.frames,interval:80}}).start();try{t.stop();let s=[...c,...u];console.log(`
$ ${o.action} ${s.join(" ")}
`),await execa(o.action,s,{stdio:"inherit"}),console.log(),t.succeed(`Executed command: ${o.name}`);}catch(s){t.fail(`Failed to execute command: ${o.name}`),s instanceof Error&&console.error(`Error: ${s.message}`);}}}function x(e){return /^<[^>]+>$/.test(e)||/^\[[^\]]+\]$/.test(e)}function H(e,c){let g=[],d=[],u=[];for(let o=0;o<e.length;o+=1){let t=e[o];if(t.startsWith("-")){let s=e[o+1],y=s!==void 0&&!s.startsWith("-"),I=y?s:null;c.has(t)?g.push({flag:t,value:I}):(d.push(t),y&&d.push(s)),y&&(o+=1);continue}u.push(t);}return {flags:g,unknownTokens:d,positionals:u}}}process.on("SIGINT",()=>process.exit(0));process.on("SIGTERM",()=>process.exit(0));async function X(){let n=new Command().name("talos").description("Manage everything.").version(b.version,"-v, --version","display the version number").enablePositionalOptions();n.addCommand(v),n.addCommand(A),n.parse();}X();//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map