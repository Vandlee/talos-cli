#!/usr/bin/env node
import {Command}from'commander';import {select,input}from'@inquirer/prompts';import E from'cli-spinners';import {execa}from'execa';import P from'ora';import*as g from'fs/promises';import S from'os';import y from'path';import r from'zod';var b=new Command("hello").description("Say hello to the user!").option("-n, --name <name>","Name to greet","World").action(e=>W(e));async function W(e){console.log(`Hello, ${e.name}`);}var w={version:"0.1.17"};var I=r.object({name:r.string(),options:r.array(r.string()),args:r.array(r.string()),action:r.string()}),M=r.object({label:r.string().optional(),version:r.string(),commands:r.array(I)}),C=r.object({name:r.string(),body:r.array(M)});async function $(e){try{let o=await O("commands");if(!o){console.error("Commands folder not found.");return}let n=y.join(o,`${e}.json`),t=await g.readFile(n,"utf-8"),c=JSON.parse(t);return C.parse(c)}catch(o){console.error(`Error finding command file: ${o}`);return}}async function N(){let e=S.homedir(),o=y.join(e,".talos");try{return await g.access(o),!0}catch{return  false}}async function O(e){let o=S.homedir();if(await N())try{let n=y.join(o,".talos",e);return await g.access(n),n}catch(n){console.error(`Error finding folder: ${n}`);return}}function x(e){return /^<[^>]+>$/.test(e)||/^\[[^\]]+\]$/.test(e)}function k(e,o){let n=[],t=[],c=[];for(let i=0;i<e.length;i+=1){let f=e[i];if(f.startsWith("-")){let u=e[i+1],p=u!==void 0&&!u.startsWith("-"),h=p?u:null;o.has(f)?n.push({flag:f,value:h}):(t.push(f),p&&t.push(u)),p&&(i+=1);continue}c.push(f);}return {flags:n,unknownTokens:t,positionals:c}}var A=new Command("e").description("Execute a command").argument("<name>","Name of the command").argument("[extras...]","Additional arguments and options").allowUnknownOption().passThroughOptions().action((e,o,n)=>B(e,n,o));async function B(e,o,n){let t=await select({message:"Where does Talos need to look for the command?",choices:[{name:"Local",value:"local"},{name:"Internet",value:"internet"}]});await V(e,t,{...o,extras:n});}async function V(e,o,n){o==="local"?await G(e,n):o==="internet"&&console.log(`Looking for ${e} on the internet...`);}async function G(e,o={}){let n=P({text:"Looking for command locally...",spinner:{frames:E.circleHalves.frames,interval:80}}).start();await new Promise(t=>setTimeout(t,1e3));try{let t=await $(e);if(!t){n.fail("Command not found locally.");return}if(n.succeed("Command found locally."),t.body.length<=0){n.fail("No versions found for this command.");return}let c=t.body[0];t.body.length>1&&(c=await select({message:"Select a command version to execute:",choices:t.body.map(d=>({name:`${d.version}${d.label?` - ${d.label}`:""}`,value:d}))})||c);let i=[],f=Array.isArray(o.extras)?o.extras:[],u=new Set(c.commands.flatMap(s=>s.options)),p=k(f,u),h=new Set(p.flags.map(s=>s.flag));for(let s of p.flags)i.push(s.flag),s.value!==null&&i.push(s.value);i.push(...p.unknownTokens),i.push(...p.positionals);for(let s of c.commands){let d=[],z=s.args.filter(a=>x(a)),F=s.args.filter(a=>!x(a));for(let a of z){let m=a.replace(/[\[\]<>]/g,"").trim()||"value",l=await input({message:`What argument are you gonna send? (${m})`});d.push(l);}d.unshift(...F);let v=[...i];if(s.options.length>0&&!s.options.some(m=>h.has(m))){let m=s.options[0],l=await input({message:`What do you want to use for "${m}" argument?`,default:""});l!==""&&v.push(m,l);}for(let a of c.commands){let m=P({text:`Executing command: ${a.name}...`,spinner:{frames:E.circleHalves.frames,interval:80}}).start();try{m.stop();let l=[...d,...v];console.log(`
$ ${a.action} ${l.join(" ")}
`),await execa(a.action,l,{stdio:"inherit"}),console.log(),m.succeed(`Executed command: ${a.name}`);}catch(l){m.fail(`Failed to execute command: ${a.name}`),l instanceof Error&&console.error(`Error: ${l.message}`);}}}}catch{}}process.on("SIGINT",()=>process.exit(0));process.on("SIGTERM",()=>process.exit(0));async function q(){let e=new Command().name("talos").description("Manage everything.").version(w.version,"-v, --version","display the version number").enablePositionalOptions();e.addCommand(b),e.addCommand(A),e.parse();}q();//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map